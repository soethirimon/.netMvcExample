@{
    Layout = LayoutService.GetLayout();
    var message = TempData["Message"] as string;
}

@if (!string.IsNullOrEmpty(message))
{
    <div id="success-message" class="alert alert-success" role="alert">
        @message
    </div>
}

<section class="content-header"></section>
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <a asp-action="CreateStudent" class="btn btn-outline-success btn-flat">
                            <h3 class="card-title">Create</h3>
                        </a>
                    </div>
                    <div class="card-body">
                        <table id="student-table" class="table table-bordered table-hover table-striped">
                            <thead>
                                <tr>
                                    <th style="width: 20%">Name</th>
                                    <th style="width: 20%">Address</th>
                                    <th style="width: 40%">Description</th>
                                    <th class="text-center" style="width: 10%">Edit</th>
                                    <th class="text-center" style="width: 10%">Delete</th>
                                </tr>
                            </thead>
                            <tbody id="student-tbody">
                                <!-- Student data will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function () {
            setTimeout(function () {
                $('#success-message').fadeOut('fast');
            }, 1000);

            // Function to fetch and populate the student list
            function fetchStudentList() {
                $.ajax({
                    url: '/Student/GetStudentList',
                    method: 'GET',
                    success: function (data) {
                        var studentTbody = $('#student-tbody');
                        studentTbody.empty();
                        data.forEach(function (student) {
                            var editUrl = '/Student/EditStudent/' + student.studentId;
                            var row = `<tr>
                                                    <td>${student.studentName}</td>
                                                    <td>${student.studentAddress}</td>
                                                    <td>${student.studentDescription}</td>
                                                    <td class="text-center">
                                                                <a href="${editUrl}" class="btn btn-sm btn-primary"> <i class="fas fa-pen-square"></i></a>
                                                    </td>
                                                    <td class="text-center">
                                                                <a href="#" class="btn btn-sm btn-danger" onclick="confirmDelete(${student.studentId})"> <i class="fas fa-trash-alt"></i></a>
                                                    </td>
                                                </tr>`;
                            studentTbody.append(row);
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching student list:', error);
                    }
                });
            }

            
            window.confirmDelete = function (id) {
                $('#delete-id').val(id);
                $('#delete-modal').modal('show');
            }

           
            $('#btn-delete-form').click(function () {
                var id = $('#delete-id').val();
                $.ajax({
                    url: '/Student/DeleteStudent',
                    method: 'POST',
                    data: { id: id },
                    success: function () {
                       
                        window.location.href = '/Student/Index';
                    },
                    error: function (xhr, status, error) {
                        console.error('Error deleting student:', error);
                    }
                });
            });

            fetchStudentList();
        });
    </script>

    <!--Delete Modal -->
    <div class="modal fade" id="delete-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Delete Student</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="modal-message">Are you sure you want to delete this student?</p>
                    <input type="hidden" name="Id" id="delete-id" />
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-flat btn-secondary ml-auto mr-2" data-dismiss="modal">Cancel</button>
                    <button id="btn-delete-form" type="button" class="btn btn-flat btn-outline-danger">Delete</button>
                </div>
            </div>
           
        </div>
       
    </div>
}
